import{c as D}from"./accepts-xg_Lkw5-.js";import{r as I}from"./bytes-D4kJ2E9_.js";import{h as C}from"./http-errors-DNGOsyiD.js";import{r as G}from"./iconv-lite-5qAB4LgQ.js";import{u as O}from"./unpipe-4hUtEN2w.js";import{r as z}from"./body-parser-ClE_Zh4T.js";/*!
 * raw-body
 * Copyright(c) 2013-2014 Jonathan Ong
 * Copyright(c) 2014-2022 Douglas Christopher Wilson
 * MIT Licensed
 */var w,R;function X(){if(R)return w;R=1;var h=_(),A=I(),c=C,x=G(),B=O;w=S;var N=/^Encoding not recognized: /;function L(e){if(!e)return null;try{return x.getDecoder(e)}catch(r){throw N.test(r.message)?c(415,"specified encoding unsupported",{encoding:e,type:"encoding.unsupported"}):r}}function S(e,r,o){var n=o,u=r||{};if(e===void 0)throw new TypeError("argument stream is required");if(typeof e!="object"||e===null||typeof e.on!="function")throw new TypeError("argument stream must be a stream");if((r===!0||typeof r=="string")&&(u={encoding:r}),typeof r=="function"&&(n=r,u={}),n!==void 0&&typeof n!="function")throw new TypeError("argument callback must be a function");if(!n&&!D.Promise)throw new TypeError("argument callback is required");var f=u.encoding!==!0?u.encoding:"utf-8",y=A.parse(u.limit),l=u.length!=null&&!isNaN(u.length)?parseInt(u.length,10):null;return n?E(e,f,l,y,k(n)):new Promise(function(a,s){E(e,f,l,y,function(v,g){if(v)return s(v);a(g)})})}function T(e){B(e),typeof e.pause=="function"&&e.pause()}function E(e,r,o,n,u){var f=!1,y=!0;if(n!==null&&o!==null&&o>n)return i(c(413,"request entity too large",{expected:o,length:o,limit:n,type:"entity.too.large"}));var l=e._readableState;if(e._decoder||l&&(l.encoding||l.decoder))return i(c(500,"stream encoding should not be set",{type:"stream.encoding.set"}));if(typeof e.readable<"u"&&!e.readable)return i(c(500,"stream is not readable",{type:"stream.not.readable"}));var d=0,a;try{a=L(r)}catch(t){return i(t)}var s=a?"":[];e.on("aborted",v),e.on("close",m),e.on("data",g),e.on("end",b),e.on("error",b),y=!1;function i(){for(var t=new Array(arguments.length),p=0;p<t.length;p++)t[p]=arguments[p];f=!0,y?process.nextTick(q):q();function q(){m(),t[0]&&T(e),u.apply(null,t)}}function v(){f||i(c(400,"request aborted",{code:"ECONNABORTED",expected:o,length:o,received:d,type:"request.aborted"}))}function g(t){f||(d+=t.length,n!==null&&d>n?i(c(413,"request entity too large",{limit:n,received:d,type:"entity.too.large"})):a?s+=a.write(t):s.push(t))}function b(t){if(!f){if(t)return i(t);if(o!==null&&d!==o)i(c(400,"request size did not match content length",{expected:o,length:o,received:d,type:"request.size.invalid"}));else{var p=a?s+(a.end()||""):Buffer.concat(s);i(null,p)}}}function m(){s=null,e.removeListener("aborted",v),e.removeListener("data",g),e.removeListener("end",b),e.removeListener("error",b),e.removeListener("close",m)}}function _(){try{return z}catch{return{}}}function k(e){var r;return h.AsyncResource&&(r=new h.AsyncResource(e.name||"bound-anonymous-fn")),!r||!r.runInAsyncScope?e:r.runInAsyncScope.bind(r,e,null)}return w}export{X as r};
